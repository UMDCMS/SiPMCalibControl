@defgroup cli0_analysis SiPM Analysis-Level commands

@ingroup cli

@brief Command typically used for single SiPM analysis level, assume nominal
calibration processes.

Here is a list of commands that will typically be used for the individual SiPM
analysis flow, here we assume that the various setup commands has already been
given to you, either by another maintainer or via the other calibration commands
discussed below. Before going into what individual command, note that all
analysis-level commands listed here will have the common output format of an
ASCII file with a various number of columns. The columns will represent the
following (for more documentation of output formats see the [`savefilecmd`](@ref
ctlcmd.cmdbase.savefilecmd) class)

- `time`: The time stamp at which the line of data is collection. Time is
  measured relative to the initialization of the command.
- `detid`: The detector ID number that the measurement is supposed to be
  performed on (this many not be used).
- `x`,`y`, `z`: The 3 gantry coordinates the measurement is performed on.
  Measured according to the internal coordinates system of the gantry.
- `biasv`: The bias voltage used for the LED pulser, measured by the ADC system.
- `ledtemp`: The temperature of the LED pulser board, measured using a voltage
  divider circuit and the ADC system.
- `sipmtmp`: The temperature of the SiPM board, measured using a voltage divider
  circuit and the ADC system.
- `data`: The remaining columns are all "data" measurements, the exact meaning of
  which will depend on the specific command used to generate the data file in
  question.

The command will typically share the following same similar command arguments

- Coordinate specification arguments:

  `-x`, `-y`, `-z`: Is typically used to specify the "central" operation
  coordinate value in gantry coordinates with units of millimeters. If either of
  the coordinates is not specified, then the current position is assumed as the
  designed coordinate values. Notice that there will be additional case handling
  if we are using predefined or calibrated coordinates of detector-on-board. See
  the "Calibration of a board" section below for more information. If you are
  calibration for single photodetectors, it is good practice to always specify
  the coordinates.

- Readout settings arguments

  - `--mode [int]`: Which readout system should be used for data collection.
    Currently, the following subsystems have been implemented. Notice that each
    subsystem has additional settings such as trigger, timing and voltage range
    that is not handled here. These should be properly set before running
    analysis level.

    - `1`: The screen-less Picoscope. For additional settings, see the "Picoscope
      related settings" section below.
    - `2`: Treating the ADC readout value as a photodetector readout. Notice that
      right now, most channels of the ADC chip is used for system status
      monitoring, so be sure that the readout channel is actually reading a real
      photodectector.
    - `3`: The DRS4 screen-less oscilloscope. For additional settings, see the
      "DRS related settings" section below.
    - `-1`: Loading a predefined model, this is useful for the debugging analysis
      sequences while not actually being attached to the system.

  - `--channel [int]`: The channel of the readout system to take for the data.
    Good practice to double-check that the readout system is connected to the
    channel of interest.

  - `--samples [int]`: The number of waveforms to take before for the readout
    average.

---

@class ctlcmd.motioncmd.lowlightcollect

@ingroup cli0_analysis

@details Collecting the data at a fixed position and collecting the data as is
a non-averaged way. This would be the command to use collect the spectral data
(plot below). To see how the data file generated by this command can make a
plot below, see the corresponding analysis script in the Analysis code
documentation [here][analysis-lowlight].

[analysis-lowlight]: https://yimuchen.github.io/SiPMCalib/

This class is based on the following meta-command classes: For details on how the
arguments affects the command behavior follow the links.

- [singlexycmd](@ref ctlcmd.cmdbase.singlexycmd): For specifying the horizontal
  position at a single (x,y) position. The visual offset flag is set to `False`
  for this command.
- [readoutcmd](@ref ctlcmd.cmdbase.readoutcmd): For setting up the readout
  specifications for data collection.
- [savefilecmd](@ref ctlcmd.cmdbase.savefilecmd): For specifying the save file.
  The default save file is now set to:
  `lowlight_<BOARDTYPE>_<BOARDID>_<DETID>_<TIMESTAMP>.txt`.

In addition to the command arguments defined in meta-command classes, additional
options defined are:

- `-z`: The gantry z value to perform the data collection.
- `-p`, `--power`: PWM duty cycle for data collection, using current PWM settings
  is not specified.

The output of the command is typically used to generate an analysis level plot
that looks like:

---

@class ctlcmd.motioncmd.halign

@ingroup cli0_analysis

@details Command designed to perform an alignment of the gantry head LED system
a target photo detecting elements. This command moves the gantry in a user
specified x-y grid collecting luminosity readout data, then it performs a fit
on the readout data assuming the light generated by the LED system is
sufficiently point-like (perfect inverse-square relation). The fitted
coordinates values are stored in the position calibration cache, while the raw
readout data used for the fit is saved to the user specified files. While plots
will not be used to evaluate SiPM properties, plotting scripts have been
provided for generating a visualization of the fitting results. See the
documentation of the plotting scripts [here][analysis-lumialign].

[analysis-lumialign]: https://yimuchen.github.io/SiPMCalib/

This class is based on the following meta-command classes. For details on how the
arguments affects the command behavior follow the links.

- [hscanxycmd](@ref ctlcmd.cmdbase.hscancmd): For specifying the horizontal
  position at a single (x,y) position. The visual offset flag is set to `False`
  for this command.
- [readoutcmd](@ref ctlcmd.cmdbase.readoutcmd): For setting up the readout
  specifications for data collection.
- [savefilecmd](@ref ctlcmd.cmdbase.savefilecmd): For specifying the save file.
  The default save file is now set to:
  `lowlight_<BOARDTYPE>_<BOARDID>_<DETID>_<TIMESTAMP>.txt`.

In addition to the command arguments of the meta-classes listed above, there
are two additional settings that can be used for this command:

- `--overwrite`: As this command is used for alignment reasons, the results of
  this command will be stored in cache according to the specified detector ID.
  The same calibration routine can be run for the same detector elements if
  requested, but will typically prompt the user whether the calibration results
  of the latest run should overwrite the existing calibration results should it
  exist. Using this flag will let the command directly overwrite the existing
  calibration results without prompting the user for confirmation. This is
  useful for running a command list script.
- `--power`: Specifying the PWM duty cycle at which the calibration routine should
  be run. If not specified, the command will simply use the current PWM settings.

For details on the execution routine, see the detailed documentation of the
`run` method.

---

@class ctlcmd.motioncmd.zscan

@ingroup cli0_analysis

@details Command designed for performing the SiPM response verses the input
light intensity. The gantry is moved over a list of z values, with each z value
potentially having a list of PWM duty cycles to scan over. This command is
designed to provide test the nonlinear response of the SiPM when under extreme
luminosity exposure (see the two plots below). The corresponding analysis
script for plotting the data collected by this command is
[`SiPM_FitNonLinear`][fitnl].

[fitnl]: https://umdcms.github.io/SiPMCalib/group__SiPMCalc

<div class="plot_example">
<img src="image/zscan_raw.png"/><br/>
  Example of the outputs of the raw data collected by the z scan command.
</div>

<div class="plot_example">
<img src="image/zscan_processed.png"/><br/>
  Example of the processed data showing the nonlinear response of the SiPM.
</div>

This class is based on the following meta-command classes. For
details on how the arguments affects the command behavior follow the links.

- [zscancmd](@ref ctlcmd.cmdbase.zscancmd): For specifying the list of z
  scanning coordinates position at a single (x,y) position. The visual offset
  flag is set to `False` for this command.
- [readoutcmd](@ref ctlcmd.cmdbase.readoutcmd): For setting up the readout
  specifications for data collection.
- [savefilecmd](@ref ctlcmd.cmdbase.savefilecmd): For specifying the save file.
  The default save file is now set to:
  `zscan_<BOARDTYPE>_<BOARDID>_<DETID>_<TIMESTAMP>.txt`

In addition to the command arguments of the meta-classes listed above, there
is 1 additional setting that can be used for this command:

- `--power`: a list of PWM duty cycle values that will be used for each z
  coordinate value. If this is not specified, then the list will only include
  the current PWM duty cycle value.

For details on the execution routine, see the detailed documentation of the
`run` method.

---

@class ctlcmd.motioncmd.timescan

@ingroup cli0_analysis

@details

---

@class ctlcmd.viscmd.visualhscan

@ingroup cli0_analysis

@details This is a test

---

@class ctlcmd.viscmd.visualcenterdet

@ingroup cli0_analysis

@details This is a test

---

@class ctlcmd.viscmd.visualmaxsharp

@ingroup cli0_analysis

@details This is a test

---
